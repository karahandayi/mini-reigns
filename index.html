<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Mini Reigns + Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body,html{margin:0;padding:0;width:100%;height:100%;font-family:Arial;background:#111;color:white;}
#start-screen,#game,#admin-panel{width:100vw;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;position:absolute;top:0;left:0;transition:opacity 0.5s;}
#start-screen{z-index:10;}
#start-screen button{padding:20px 40px;font-size:24px;cursor:pointer;border:none;border-radius:10px;background:#444;color:white;}
#game{display:none;flex-direction:column;align-items:center;justify-content:flex-start;overflow:hidden;}
#stats{width:90%;display:flex;justify-content:space-between;margin-top:10px;}
.stat{width:23%;}
.bar{height:10px;background:#333;border-radius:5px;overflow:hidden;}
.fill{height:100%;background:lime;width:50%;transition:width 0.3s;}
#card-container{flex:1;display:flex;align-items:center;justify-content:center;width:100%;}
#card{width:300px;height:180px;background:#2c2c2c;border-radius:12px;padding:20px;text-align:center;cursor:grab;user-select:none;display:flex;flex-direction:column;justify-content:center;align-items:center;transition:transform 0.2s;}
#card img{max-width:80px;margin-bottom:10px;border-radius:5px;}
#hint{margin-bottom:20px;opacity:0.6;}
#admin-panel{display:none;flex-direction:column;align-items:flex-start;justify-content:flex-start;overflow-y:auto;padding:10px;background:#222;max-height:100vh;}
#admin-panel input,#admin-panel textarea,#admin-panel button,#admin-panel label{width:100%;margin:3px 0;padding:5px;}
#card-list li{cursor:pointer;margin-bottom:3px;}
h3,h4{margin:5px 0;text-align:center;}
#music-controls{margin:5px 0;display:flex;justify-content:space-between;}
</style>
</head>
<body>

<div id="start-screen">
  <h1>Mini Reigns</h1>
  <button id="start-btn">BaÅŸla</button>
</div>

<div id="game">
  <div id="stats">
    <div class="stat">ğŸ‘‘ <span class="stat-title">Halk</span><div class="bar"><div id="halk" class="fill"></div></div></div>
    <div class="stat">â›ª <span class="stat-title">Kilise</span><div class="bar"><div id="kilise" class="fill"></div></div></div>
    <div class="stat">ğŸ’° <span class="stat-title">Hazine</span><div class="bar"><div id="hazine" class="fill"></div></div></div>
    <div class="stat">âš”ï¸ <span class="stat-title">Ordu</span><div class="bar"><div id="ordu" class="fill"></div></div></div>
  </div>
  <div id="card-container">
    <div id="card"><img id="card-img" src="" alt=""><div id="card-text"></div></div>
  </div>
  <div id="hint">â† HAYIR | EVET â†’</div>
</div>

<div id="admin-panel">
  <h3>Admin Paneli</h3>

  <h4>BaÅŸlangÄ±Ã§ EkranÄ± Arkaplan</h4>
  <input id="admin-start-bg" placeholder="BaÅŸlangÄ±Ã§ ekranÄ± URL">

  <h4>Oyun ArkaplanÄ±</h4>
  <input id="admin-bg" placeholder="Oyun arkaplan URL">

  <h4>MÃ¼zik (YouTube)</h4>
  <input id="admin-music" placeholder="YouTube linki">
  <div id="music-controls">
    <button id="play-music">â–¶ï¸ AÃ§</button>
    <button id="pause-music">â¸ Kapat</button>
  </div>

  <h4>Stat BaÅŸlangÄ±Ã§</h4>
  <label>Halk:</label><input id="admin-halk" type="number">
  <label>Kilise:</label><input id="admin-kilise" type="number">
  <label>Hazine:</label><input id="admin-hazine" type="number">
  <label>Ordu:</label><input id="admin-ordu" type="number">

  <h4>Stat BaÅŸlÄ±klarÄ±</h4>
  <label>Stat 1:</label><input id="admin-title-halk" type="text">
  <label>Stat 2:</label><input id="admin-title-kilise" type="text">
  <label>Stat 3:</label><input id="admin-title-hazine" type="text">
  <label>Stat 4:</label><input id="admin-title-ordu" type="text">

  <hr>
  <h4>Kart Ekle/DÃ¼zenle</h4>
  <textarea id="admin-text" placeholder="Kart metni"></textarea>
  <input id="admin-img" placeholder="Kart gÃ¶rsel URL">
  <input id="admin-yes" placeholder='{"halk":10,"hazine":-5}'>
  <input id="admin-no" placeholder='{"halk":-5}'>
  <button id="add-card">Kart Ekle</button>
  <ul id="card-list"></ul>

  <hr>
  <button id="save-admin">ğŸ’¾ Kaydet</button>
</div>

<div id="music-container" style="display:none;"></div>

<script>
// LocalStorage key
const STORAGE_KEY="miniReignsData";

// DeÄŸiÅŸkenler
let stats={halk:50,kilise:50,hazine:50,ordu:50};
let cards=[
  {text:"KÃ¶ylÃ¼ler vergilerin dÃ¼ÅŸÃ¼rÃ¼lmesini istiyor.",img:"https://via.placeholder.com/80",yes:{halk:10,hazine:-10},no:{halk:-10}},
  {text:"Ordu yeni silahlar istiyor.",img:"https://via.placeholder.com/80",yes:{ordu:10,hazine:-15},no:{ordu:-10}}
];
let titles={halk:"Halk",kilise:"Kilise",hazine:"Hazine",ordu:"Ordu"};
let backgrounds={start:"",game:""};
let musicUrl="";
let musicFrame=null;

// Elementler
const startScreen=document.getElementById("start-screen");
const startBtn=document.getElementById("start-btn");
const gameDiv=document.getElementById("game");
const cardEl=document.getElementById("card");
const cardText=document.getElementById("card-text");
const cardImg=document.getElementById("card-img");
const adminPanel=document.getElementById("admin-panel");

// Load data
function loadData(){
  const data=JSON.parse(localStorage.getItem(STORAGE_KEY)||"{}");
  if(data.stats) stats=data.stats;
  if(data.cards) cards=data.cards;
  if(data.titles) titles=data.titles;
  if(data.backgrounds) backgrounds=data.backgrounds;
  if(data.musicUrl) musicUrl=data.musicUrl;

  updateStats();
  nextCard();

  document.querySelector('#stats .stat:nth-child(1) .stat-title').innerText=titles.halk;
  document.querySelector('#stats .stat:nth-child(2) .stat-title').innerText=titles.kilise;
  document.querySelector('#stats .stat:nth-child(3) .stat-title').innerText=titles.hazine;
  document.querySelector('#stats .stat:nth-child(4) .stat-title').innerText=titles.ordu;

  if(backgrounds.start) startScreen.style.background=`url(${backgrounds.start}) center/cover no-repeat`;
  if(backgrounds.game) gameDiv.style.background=`url(${backgrounds.game}) center/cover no-repeat`;

  document.getElementById("admin-halk").value=stats.halk;
  document.getElementById("admin-kilise").value=stats.kilise;
  document.getElementById("admin-hazine").value=stats.hazine;
  document.getElementById("admin-ordu").value=stats.ordu;
  document.getElementById("admin-title-halk").value=titles.halk;
  document.getElementById("admin-title-kilise").value=titles.kilise;
  document.getElementById("admin-title-hazine").value=titles.hazine;
  document.getElementById("admin-title-ordu").value=titles.ordu;
  document.getElementById("admin-bg").value=backgrounds.game;
  document.getElementById("admin-start-bg").value=backgrounds.start;
  document.getElementById("admin-music").value=musicUrl;
  refreshCardList();
}

// Save data
function saveData(){
  localStorage.setItem(STORAGE_KEY,JSON.stringify({stats,cards,titles,backgrounds,musicUrl}));
}

// BaÅŸlat
startBtn.onclick=()=>{
  startScreen.style.display="none";
  gameDiv.style.display="flex";
};

// Hash ile admin aÃ§
document.addEventListener("DOMContentLoaded",()=>{
  if(window.location.hash==="#admin"){
    startScreen.style.display="none";
    gameDiv.style.display="none";
    adminPanel.style.display="flex";
  }
});

// Update stats
function updateStats(){
  for(let key in stats){
    stats[key]=Math.max(0,Math.min(100,stats[key]));
    document.getElementById(key).style.width=stats[key]+"%";
  }
}

// Ã–lÃ¼m kontrolÃ¼
function checkDeath(){
  for(let key in stats){
    if(stats[key]<=0||stats[key]>=100){alert("Ã–ldÃ¼n! Sebep: "+key.toUpperCase());location.reload();}
  }
}

// Kartlar
let currentCard=null;
function nextCard(){
  if(cards.length===0){cardText.innerText="Kart yok";cardImg.src="";return;}
  currentCard=cards[Math.floor(Math.random()*cards.length)];
  cardText.innerText=currentCard.text;
  cardImg.src=currentCard.img||"";
}

// Drag
let startX=0,dragging=false;
cardEl.addEventListener("mousedown",e=>{dragging=true;startX=e.clientX;});
document.addEventListener("mousemove",e=>{if(!dragging)return;let dx=e.clientX-startX;cardEl.style.transform=`translateX(${dx}px) rotate(${dx/10}deg)`;});
document.addEventListener("mouseup",e=>{if(!dragging)return;dragging=false;handleDecision(e.clientX-startX);});
cardEl.addEventListener("touchstart",e=>{startX=e.touches[0].clientX;});
cardEl.addEventListener("touchmove",e=>{let dx=e.touches[0].clientX-startX;cardEl.style.transform=`translateX(${dx}px) rotate(${dx/10}deg)`;});
cardEl.addEventListener("touchend",e=>{let dx=parseInt(cardEl.style.transform.match(/-?\d+/))||0;handleDecision(dx);});

function handleDecision(dx){
  if(dx>100) applyResult("yes");
  else if(dx<-100) applyResult("no");
  else cardEl.style.transform="translateX(0px)";
}

function applyResult(choice){
  const effects=currentCard[choice];
  for(let key in effects) stats[key]+=effects[key];
  updateStats(); checkDeath(); nextCard();
}

// Kart ekleme ve liste
function refreshCardList(){
  const list=document.getElementById("card-list");
  list.innerHTML="";
  cards.forEach((c,i)=>{
    const li=document.createElement("li");
    li.innerText=c.text;
    li.onclick=()=>{
      document.getElementById("admin-text").value=c.text;
      document.getElementById("admin-img").value=c.img||"";
      document.getElementById("admin-yes").value=JSON.stringify(c.yes);
      document.getElementById("admin-no").value=JSON.stringify(c.no);
    };
    list.appendChild(li);
  });
}
document.getElementById("add-card").onclick=()=>{
  const text=document.getElementById("admin-text").value;
  const img=document.getElementById("admin-img").value;
  let yes,no;
  try{yes=JSON.parse(document.getElementById("admin-yes").value);no=JSON.parse(document.getElementById("admin-no").value);}catch(e){alert("JSON hatalÄ±!");return;}
  cards.push({text,img,yes,no});
  refreshCardList();
  nextCard();
};

// Admin kaydet
document.getElementById("save-admin").onclick=()=>{
  stats.halk=parseInt(document.getElementById("admin-halk").value)||50;
  stats.kilise=parseInt(document.getElementById("admin-kilise").value)||50;
  stats.hazine=parseInt(document.getElementById("admin-hazine").value)||50;
  stats.ordu=parseInt(document.getElementById("admin-ordu").value)||50;
  titles.halk=document.getElementById("admin-title-halk").value;
  titles.kilise=document.getElementById("admin-title-kilise").value;
  titles.hazine=document.getElementById("admin-title-hazine").value;
  titles.ordu=document.getElementById("admin-title-ordu").value;
  backgrounds.start=document.getElementById("admin-start-bg").value;
  backgrounds.game=document.getElementById("admin-bg").value;
  musicUrl=document.getElementById("admin-music").value;
  saveData();
  alert("TÃ¼m ayarlar kaydedildi!");
};

// Stat baÅŸlÄ±klarÄ± deÄŸiÅŸimi
document.getElementById("admin-title-halk").oninput=e=>{document.querySelector('#stats .stat:nth-child(1) .stat-title').innerText=e.target.value;};
document.getElementById("admin-title-kilise").oninput=e=>{document.querySelector('#stats .stat:nth-child(2) .stat-title').innerText=e.target.value;};
document.getElementById("admin-title-hazine").oninput=e=>{document.querySelector('#stats .stat:nth-child(3) .stat-title').innerText=e.target.value;};
document.getElementById("admin-title-ordu").oninput=e=>{document.querySelector('#stats .stat:nth-child(4) .stat-title').innerText=e.target.value;};

// Arkaplan deÄŸiÅŸimi anlÄ±k
document.getElementById("admin-start-bg").oninput=e=>{startScreen.style.background=`url(${e.target.value}) center/cover no-repeat`;}
document.getElementById("admin-bg").oninput=e=>{gameDiv.style.background=`url(${e.target.value}) center/cover no-repeat`;}

// MÃ¼zik
document.getElementById("play-music").onclick=()=>{
  if(musicFrame) musicFrame.remove();
  if(musicUrl){
    let vid="";
    try{vid=musicUrl.split("v=")[1].split("&")[0];}catch(e){vid="";}
    if(vid){musicFrame=document.createElement("iframe");musicFrame.width=0;musicFrame.height=0;musicFrame.src=`https://www.youtube.com/embed/${vid}?autoplay=1&loop=1&playlist=${vid}`;musicFrame.allow="autoplay";musicFrame.style.display="none";document.body.appendChild(musicFrame);}
  }
};
document.getElementById("pause-music").onclick=()=>{if(musicFrame) musicFrame.remove();musicFrame=null;};

// BaÅŸlat
loadData();
nextCard();
updateStats();
</script>
</body>
</html>
